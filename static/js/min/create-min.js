function initialize(){addSportSelectCascade(),"object"==typeof google&&"object"==typeof google.maps&&"location"===wizard_step&&("undefined"!=typeof $("#id_location-lat")&&(lat=parseFloat($("#id_location-lat").val()),lng=parseFloat($("#id_location-lng").val())),mapOptions={mapTypeId:google.maps.MapTypeId.TERRAIN,center:{lat:lat,lng:lng},zoom:8,maxZoom:15,panControl:!1,zoomControl:!0,streetViewControl:!1},lat&&lng?formatted_address=$("#id_location-street_number").val()+" "+$("#id_location-route").val()+", "+$("#id_location-postal_code").val()+" "+$("#id_location-locality").val()+", "+$("#id_location-country").val():(mapOptions.center={lat:46.9,lng:2.6},mapOptions.zoom=5),createMap(),autocomplete=new google.maps.places.Autocomplete(document.getElementById("autocompleteInput"),{types:["geocode"]}),google.maps.event.addListener(autocomplete,"place_changed",function(){clearForm(),changeAddress()}),initLocationLayout()),native_datepicker||($("input[type=date]").attr("type","text"),createDatePickerComponent())}function addLocationSelectConstraint(){}function addSportSelectCascade(){var e=$("#id_race-distance_cat"),t=$("#id_race-sport"),o=[];$(e).find("option").each(function(){o.push({value:$(this).val(),text:$(this).text()})}),$(e).data("options",o),$("#id_race-sport").on("change",function(){var o=$(e).empty().scrollTop(0).data("options"),a="\\("+$.trim($(t).children(":selected").text())+"\\)",n=new RegExp(a,"gi");$.each(o,function(t){var a=o[t];null!==a.text.match(n)&&$(e).append($("<option>").text(a.text).val(a.value))})})}function initLocationLayout(){$("#edit-form .form-group").hide(),$(".field-error").html("Merci de pr√©ciser le code postal"),$(".field-error").parent().show(),""===formatted_address?($("#selected-address").hide(),$("#autocompleteInput").show()):($("#selected-address-title").html(formatted_address),$("#selected-address").show(),$("#autocompleteInput").hide()),$("#edit-form").submit(function(e){$("#autocompleteInput").is(":hidden")&&(e.preventDefault(),$("#autocompleteInput").css({border:"solid 1px red"}),$("html, body").animate({scrollTop:0},"slow"))})}function createDatePickerComponent(){$(".datepicker").datepicker({format:"yyyy-mm-dd",language:"fr",autoclose:!0,clearBtn:!0,todayHighlight:!0,todayBtn:"linked"})}function createMap(){"undefined"==typeof map_styles&&(map_styles=[]),map=new google.maps.Map(document.getElementById("address-map"),mapOptions),map.setOptions({styles:map_styles}),marker=new google.maps.Marker({position:{lat:lat,lng:lng},map:map,zIndex:1})}function clearForm(){var e=document.getElementById("edit-form").elements;for(i=0;i<e.length;i++)if(field_type=e[i].type.toLowerCase(),"csrfmiddlewaretoken"!==e[i].name&&"race_edit-current_step"!==e[i].name)switch(field_type){case"text":case"password":case"textarea":case"hidden":e[i].value="";break;case"radio":case"checkbox":e[i].checked&&(e[i].checked=!1);break;case"select-one":case"select-multi":e[i].selectedIndex=-1}}function changeAddress(){var e=autocomplete.getPlace();$("#location-form :input:not(:hidden)").val("");for(var t=0;t<e.address_components.length;t++){var o=e.address_components[t].types[0],a=componentForm[o];if("undefined"!=typeof a)for(var n=0;n<a.length;n++){var i=e.address_components[t][a[n].selector];document.getElementById(a[n].id).value=i}formatted_address=e.formatted_address}marker.setMap(null),lat=e.geometry.location.lat(),lng=e.geometry.location.lng(),marker=new google.maps.Marker({position:{lat:lat,lng:lng},map:map,zIndex:1}),map.setCenter(marker.getPosition()),google.maps.event.addListenerOnce(map,"bounds_changed",function(e){this.getZoom()&&this.setZoom(12)}),document.getElementById("id_location-lat").value=lat.toFixed(5),document.getElementById("id_location-lng").value=lng.toFixed(5),initLocationLayout()}function geolocate(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),o=new google.maps.Circle({center:t,radius:e.coords.accuracy});autocomplete.setBounds(o.getBounds())})}var native_datepicker=Modernizr.touch,formatted_address,mapOptions,marker,componentForm={street_number:[{id:"id_location-street_number",selector:"short_name"}],route:[{id:"id_location-route",selector:"short_name"}],locality:[{id:"id_location-locality",selector:"short_name"}],country:[{id:"id_location-country",selector:"short_name"}],postal_code:[{id:"id_location-postal_code",selector:"short_name"}]};$(document).ready(function(){initialize()});